# Афинные преобразования

## Сдвиг

Сдвиги вдоль направления осей системы координат или их комбинации описываются следующими координатными уравнениями и соответствующими матрицами:

```
{x' = x + Sxy * y
{y' = y + Syx * x

S2 = |1   Syx|
     |Sxy 1  |

{x' = x + Sxy * y + Sxz * z
{y' = Syx * x + y + Syz * z
{z' = Szx * x + Szy * y + z

     |1   Syx Szx|
S3 = |Sxy 1   Szy|
     |Sxz Syz 1  |
```

Параметры сдвига задают не-диагональные элементы матрицы (S2 для плоскости, S3 для пространства). Коэффициенты матрицы вида `Sij` есть единица смещения вдоль оси
соответствующей координате `j`.

...

Центр сдвига при произвольных параметрах векторы смещения сдвиговой матрицы находится в начале координат. `Xij != 0` - не единственный в матрице `Sn`, то векторы смещения
смещение осуществляется вдоль нескольких осей системы координат и его нельзя заменить последовательностью сдвигов вдоль каждой оси.

## Вращение

Вращение точки на плоскости OXY описывается координатными уравнениями следующего вида:

```
{x' = r * cos(alpha + phi) = x * cos(phi) - y * sin(phi)
{y' = r * sin(alpha + phi) = x * sin(phi) + y * cos(phi)

R(phi) = | cos(phi) sin(phi)|, R(-phi) = |cos(phi) -sin(phi)| = Rt(phi) = R(phi)^-1
         |-sin(phi) cos(phi)|            |sin(phi)  cos(phi)|
```

При вращении точки в пространстве вокруг осей правой системы координат, матрицы вращений получаются из следующих соотношений:

 1. ```
x' = x, y' = y * cos(PHIx) - z * sin(PHIx), z' = y * sin(PHIx) + z * cos(PHIx)

           |1  0         1         |
Rx(PHIx) = |0  cos(PHIx) sin(PHIx) | Rx(-phi) = Rx(PHIx)^-1
           |0 -sin(PHIx) cos(PHIx) |
```

 2. ```
x' = x * cos(PHIy) + z * sin(PHIy), y' = y, z' = -x * sin(PHIy) + z * cos(PHIy)

           |cos(PHIy) 0 -sin(PHIy)|
Ry(PHIy) = |0         1  0        |, Ry(-PHIy) = Ry(PHIy)^-1
           |sin(PHIy) 0  cos(PHIy)|
```

 3. ```
x' = x * cos(PHIz) - y * sin(PHIz), y' = x * sin(PHIz) + y * cos(PHIz), z' = z

           | cos(PHIz) sin(PHIz) 0|
Rz(PHIz) = |-sin(PHIz) cos(PHIz) 0|
           | 0         0         1|
```

Преобразование вращения не изменяет углы между синхронно вращающимися векторами, площади, объёмы и формулы геометрических фигур, а также топологический смысл полигонов.

**Свойство:** определители всех матриц вращения равны 1.

Благодаря свойствам ортогональности:
```
R * Rt = Rt  R = En
R(phi)^-1 = Rt(phi)
```

...образующих цилиндрическое поле. Центр всех вращений на произвольные углы располагается в начале координат, а вращательное смещение `d = p * (Romega(phi) - En)`
(`omega` принадлежит `{x, y, z}`)

Строго говоря, это преобразование не элементарное, а является последовательностью масштабирования и сдвига, но, ввиду простоты понимания, распространённости и важности
вращения в системе геометрических образований, целесообразно считать его элементарным.

# Сложные афинные преобразованиями

Сложными называют преобразования, состоящие из двух элементарных преобразований. Почти что все афинные преобразования **некоммутативны**, т.е. результат из цепочки `C1`,
`C2` зависит от порядка их выполнения. В качестве примера рассмотрим комбинацию вращения объекта и переносом на вектор deltaP.

Но у любого правила есть исключения - это перенос-перенос и масштабирование-масштабирование:
```
T(deltaP1) * T(deltaP2) = |En      Onx1| * |En      Onx1|
                          |deltaP1 1   |   |deltaP2 1   |

|En                Onx1| = T(deltaP2) * T(deltaP1)
|deltaP1 + deltaP2 1   |
```

```
                                |mx 0  0 |   |Mx 0  0 |
M(mx, my, mz) * M(Mx, My, Mz) = |0  my 0 | * |0  My 0 | = M(Mx, My, Mz) * M(mx, my, mz)
                                |0  0  mz|   |0  0  Mz|
```

# Методы рассчёта матрицы сложного афинного преобразования

Рассмотрим два метода рассчёта матрицы преобразования `C` в задачах с произвольным расположением осей, прямых и плоскостей отражения.

 1. Метод разложения (декомпозиции) сложного движения объекта на `n` элементарных движений, описываемых матрицами `Ci` описываемых относительно координатных осей и
плоскостей неподвижной системы координат. Процесс разложения на составные части является отличительной чертой методов "серого ящика", в котором форма, т.е. начальное и
конечное состояние объекта наполняется содержанием промежуточных состояний и способами их достижения не единственным возможным образом.

Полезным приёмом, часто облегчающим выбор элементарных преобразований является временный переход от системы координат с матрицей `Ck` в такое положение, где оси вращения
прямые, а плоскости отражения становятся координатами. Выполняются необходимые афинные преобразования с общей матрицей `Q`, а далее осуществляется восстановление системы
координат в исходное, описываемое матрицей, обратной данной.

`C = Ck * Q * Ck^-1`

При рассчёте матрицы `Ck` важно помнить об инвертировании знаков параметров афинных преобразований при вращении вокруг оси X.

 2. Метод парных точек, который определяет матрицу афинного преобразования по трём на плоскости или четырём в пространстве парами ЛНЗ точек образа и праобраза.
